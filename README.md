# Cerberus
Cerberus is a tool designed to simplify the process of internal intrusion, allowing to prioritize the most relevant assets and additionally works as a storage of information from security tools such as Mimikatz or secretsdump, allowing to have all the information continuously updated. With Cerberus, users can collect all data extracted from these tools and store it in a centralized database for easy access and analysis.

Using Cerberus makes it possible to collect and analyze valuable information efficiently and effectively, integrating all the information extracted from the different computers in an infrastructure into one database.

## Features
- Collect data from Mimikatz sekurlsa::logonpasswords.
- Collect data from Mimikatz lsadump::sam.
- Collect data and tickets from Mimikatz sekurlsa::tickets.
- Collect data from Impacket secretsdump.
- Craft silver tickets from credentials.
- Add credentials to the database.
- Ingest domain information from a dump generated by ADExplorer in neo4j database.
- Synchronization of the collected data with a neo4j database, allowing to automatically mark compromised users.
- Graph section, allowing to visualize relevant domain information.


## Modules

This section shows the different modules implemented in the tool to ingest data and an example of the commands that can be used to collect the information in a correct format.

### Mimikatz

#### sekurlsa::logonpasswords
```powershell
mimikatz.exe "privilege::debug" "log <output_file>" "sekurlsa::logonpasswords" exit
```
#### lsadump::sam
```powershell
mimikatz.exe "privilege::debug" "token::elevate" "log <output_file>" "lsadump::sam" exit
```
#### sekurlsa::tickets
```powershell
mimikatz.exe "privilege::debug" "log <output_file>" "sekurlsa::tickets /export" exit
```
This module has two possibilities:

1. If tickets are uploaded in the "Uploads Tickets" section before the ticket output is read, the content of the ticket will be saved in the database, allowing you to download the ticket later in .kirbi format or copy it in base64.
2. If tickets are not uploaded, all information except the content of the ticket itself will be saved.

### Impacket
#### secretsdump
```bash
impacket-secretsdump <domain>/<user>:<password>@<ip>
```

### Graph
This feature allows you to graphically visualize the various assets of a domain along with important information to carry out an attack more effectively.

To use this functionality, it is necessary to have the domain information ingested in a neo4j database, whose credentials must be added in the settings section, located in the upper right corner.

To ingest domain information, you can do it either from the import section or by using the icon located within the graph. To do this, you need to provide a dump created with ADExplorer or the corresponding JSON files.

This functionality is currently under development, which means that there may be limitations, bugs or missing features.

## Quickstart

Use of a virtual environment is recommended
### Creating and Activating a Python Virtual Environment

A virtual environment is a self-contained Python environment that allows you to install and manage packages separately from your system-wide Python installation. It helps keep your project dependencies organized and isolated. Here's how you can create and activate a Python virtual environment:

#### Step 1: Create a virtual environment
To create a virtual environment, navigate to the directory where you want to create it and run the following command:

```shell
python3 -m venv myenv
```
#### Step 2: Activate the virtual environment

```shell
source myenv/bin/activate
```

Now that your virtual environment is active you can proceed to install the project dependencies.

## Installation

```bash
git clone https://github.com/SilentForceOfficial/Cerberus.git
cd Cerberus
pip install -r requirements.txt
```
Once the dependencies have been installed, it is recommended to deactivate and reactivate the virtual environment to avoid errors related to these dependencies.

```bash
deactivate
source myenv/bin/activate
```
To initialize the bbdd, execute the following command, indicating the user name and password to access the application.
If no username and password are specified, the default will be "cerberus".

```bash
flask --app cerberus setup
```

If you want to specify a different username or password, you can indicate it as follows.
```bash
flask --app cerberus setup --user cerberus --password cerberus
```

## Usage

```bash
flask --app cerberus run
```
The web server will start on localhost at port 5000 by default.

To allow access to the application from the network or modify the default port, use the parameters "host" and "port".

```bash
flask --app cerberus run --host 0.0.0.0 --port 1234
```

If the application is going to be exposed on the network, it is recommended to change the SECRET_KEY of the application, located in instance/config.py

## Limitations
- When a large file is uploaded, the application will load while ingesting the information, but this does not mean that the application has crashed.
- Neo4j only allows to have one database with the free version, so the connection to the neo4j database is independent to the different databases of the tool.